<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Project Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
          box-sizing: border-box;
          font-family: 'Roboto', sans-serif;
          margin: 0;
          padding: 0;
        }

        body {
          background: linear-gradient(to right, #e3f2fd, #fce4ec);
          color: #333;
          min-height: 100vh;
          padding-bottom: 40px;
        }

        header {
          background: linear-gradient(to right, #2196f3, #e91e63);
          color: white;
          padding: 1.5rem;
          text-align: center;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
          position: relative;
        }

        header h1 {
          font-size: 2rem;
        }

        .logout {
          position: absolute;
          top: 1.5rem;
          right: 2rem;
          background: #f44336;
          color: white;
          border: none;
          padding: 10px 15px;
          border-radius: 5px;
          font-weight: bold;
          cursor: pointer;
          transition: background 0.3s ease;
        }

        .logout:hover {
          background: #d32f2f;
        }

        .container {
          max-width: 900px;
          margin: 2rem auto;
          padding: 2rem;
          background: white;
          border-radius: 10px;
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        h2 {
          margin-bottom: 1.5rem;
          font-size: 1.6rem;
          color: #1976d2;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        input[type="text"], select {
          padding: 12px;
          width: 100%;
          border: 2px solid #ccc;
          border-radius: 6px;
          transition: 0.3s;
        }

        input[type="text"]:focus, select:focus {
          border-color: #1976d2;
          outline: none;
        }

        .form-actions {
          text-align: right;
        }

        button, .btn {
          padding: 10px 15px;
          border: none;
          border-radius: 6px;
          font-weight: bold;
          cursor: pointer;
          transition: all 0.3s ease;
        }

        button[type="submit"] {
          background-color: #2196f3;
          color: white;
        }

        button[type="submit"]:hover {
          background-color: #1976d2;
        }

        .project {
          border: 2px solid #f1f1f1;
          border-radius: 10px;
          padding: 1.5rem;
          margin-bottom: 1.5rem;
          background: #fafafa;
          transition: transform 0.2s ease;
        }

        .project:hover {
          transform: scale(1.02);
        }

        .project input, .project select {
          margin-top: 8px;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 5px;
          width: 100%;
        }

        .project-actions {
          margin-top: 10px;
          text-align: right;
        }

        .btn-edit {
          background-color: #ffa726;
          color: white;
        }

        .btn-edit:hover {
          background-color: #fb8c00;
        }

        .btn-save {
          background-color: #4caf50;
          color: white;
        }

        .btn-save:hover {
          background-color: #388e3c;
        }

        .btn-cancel {
          background-color: #9e9e9e;
          color: white;
        }

        .btn-cancel:hover {
          background-color: #757575;
        }

        .btn-delete {
          background-color: #e53935;
          color: white;
        }

        .btn-delete:hover {
          background-color: #c62828;
        }

        .task-input {
          display: flex;
          gap: 0.5rem;
          margin-top: 1rem;
        }

        .task-input input {
          flex: 1;
        }

        .task-input button {
          background-color: #5c6bc0;
          color: white;
        }

        .task-input button:hover {
          background-color: #3949ab;
        }

        .task-item {
          margin: 6px 0;
        }

        .completed-task {
          text-decoration: line-through;
          color: #888;
        }
    </style>
</head>
<body>

<header>
    <h1>Welcome to Project Dashboard</h1>
    <button class="logout" onclick="logout()">Logout</button>
</header>

<div class="container">
    <h2>Create New Project</h2>
    <form id="projectForm">
        <div class="form-group">
            <input type="text" id="projectName" placeholder="Project Name" required />
        </div>
        <div class="form-group">
            <select id="projectStatus" required>
                <option value="">Select Status</option>
                <option value="Pending">Pending</option>
                <option value="In Progress">In Progress</option>
                <option value="Completed">Completed</option>
            </select>
        </div>
        <div class="form-actions">
            <button type="submit">Add Project</button>
        </div>
    </form>

    <h2>Your Projects</h2>
    <div id="projectList"></div>
</div>

<script>
    const token = localStorage.getItem("token");
    if (!token) {
      window.location.href = "index.html";
    }

    function logout() {
      localStorage.removeItem("token");
      window.location.href = "index.html";
    }

    async function fetchProjects() {
      try {
        const res = await fetch("http://localhost:8080/api/projects", {
          headers: { Authorization: "Bearer " + token },
        });
        const projects = await res.json();
        renderProjects(projects);
      } catch (err) {
        alert("Failed to fetch projects");
        console.error(err);
      }
    }

    function renderProjects(projects) {
      const projectList = document.getElementById("projectList");
      projectList.innerHTML = "";
      projects.forEach((project) => {
        const div = document.createElement("div");
        div.className = "project";
        div.innerHTML = `
          <input type="text" value="${project.name}" disabled id="name-${project.id}" />
          <select disabled id="status-${project.id}">
            <option value="Pending" ${project.status === "Pending" ? "selected" : ""}>Pending</option>
            <option value="In Progress" ${project.status === "In Progress" ? "selected" : ""}>In Progress</option>
            <option value="Completed" ${project.status === "Completed" ? "selected" : ""}>Completed</option>
          </select>
          <div class="task-input">
            <input type="text" id="new-task-${project.id}" placeholder="Add task" />
            <button onclick="addTask(${project.id})">Add</button>
          </div>
          <div class="tasks" id="task-list-${project.id}"></div>
          <div class="project-actions" id="actions-${project.id}">
            <button class="btn btn-edit" onclick="enableEdit(${project.id})">Edit</button>
            <button class="btn btn-delete" onclick="deleteProject(${project.id})">Delete</button>
          </div>
        `;
        projectList.appendChild(div);
      });
    }

    function addTask(projectId) {
      const input = document.getElementById(`new-task-${projectId}`);
      const taskText = input.value.trim();
      if (!taskText) return;

      const taskContainer = document.getElementById(`task-list-${projectId}`);
      const div = document.createElement("div");
      div.className = "task-item";
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      const label = document.createElement("label");

      checkbox.onchange = function () {
        if (checkbox.checked) {
          label.classList.add("completed-task");
        } else {
          label.classList.remove("completed-task");
        }
      };

      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(" " + taskText));
      div.appendChild(label);
      taskContainer.appendChild(div);
      input.value = "";
    }

    function enableEdit(id) {
      document.getElementById(`name-${id}`).disabled = false;
      document.getElementById(`status-${id}`).disabled = false;
      const actions = document.getElementById(`actions-${id}`);
      actions.innerHTML = `
        <button class="btn btn-save" onclick="saveProject(${id})">Save</button>
        <button class="btn btn-cancel" onclick="cancelEdit(${id})">Cancel</button>
      `;
    }

    function cancelEdit(id) {
      fetchProjects();
    }

    async function saveProject(id) {
      const name = document.getElementById(`name-${id}`).value.trim();
      const status = document.getElementById(`status-${id}`).value;
      try {
        const res = await fetch(`http://localhost:8080/api/projects/${id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
          body: JSON.stringify({ name, status }),
        });
        if (res.ok) {
          fetchProjects();
        } else {
          alert("Failed to update project");
        }
      } catch (err) {
        alert("Backend error");
      }
    }

    async function deleteProject(id) {
      if (!confirm("Are you sure?")) return;
      try {
        const res = await fetch(`http://localhost:8080/api/projects/${id}`, {
          method: "DELETE",
          headers: {
            Authorization: "Bearer " + token,
          },
        });
        if (res.ok) {
          fetchProjects();
        } else {
          alert("Failed to delete project");
        }
      } catch (err) {
        alert("Backend error");
      }
    }

    document.getElementById("projectForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const name = document.getElementById("projectName").value;
      const status = document.getElementById("projectStatus").value;

      try {
        const res = await fetch("http://localhost:8080/api/projects", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
          body: JSON.stringify({ name, status }),
        });

        if (res.ok) {
          document.getElementById("projectForm").reset();
          fetchProjects();
        } else {
          alert("Failed to add project");
        }
      } catch (err) {
        alert("Backend unreachable");
      }
    });

    fetchProjects();
</script>

</body>
</html>
